<!DOCTYPE html>
<html>
  <head>
    <title>Tabuleiro de Damas</title>
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
  </head>
  <style>
    #board {
      border-collapse: collapse;
      margin-bottom: 70px;
      border: 5px solid black;
    }

    #board tr {
      display: flex;
    }

    #board td {
      width: 50px;
      height: 50px;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .piece {
      width: 40px;
      height: 40px;
      border-radius: 50%;
    }

    .piece.black {
      background-color: #333;
    }

    .piece.white {
      background-color: #eee;
    }

    .piece.black.king {
      border: 3px solid #ff0;
    }

    .piece.white.king {
      border: 3px solid #f00;
    }

    .dark {
      background-color: #663300;
    }

    .light {
      background-color: #ffcc66;
    }

    .selected {
      background-color: #f00;
    }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      font-family: arial;
    }
    button {
      padding: 10px;
      background-color: #ffbb66;
      border-radius: 200px;
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    button svg {
      width: 40px;
      height: 40px;
    }
  </style>
  <body>
    <h1>Tabuleiro de Damas</h1>
    <h2 id="vencedor"></h2>
    <table id="board"></table>
    <button onclick="reiniciar()">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="16"
        height="16"
        fill="currentColor"
        class="bi bi-arrow-clockwise"
        viewBox="0 0 16 16"
      >
        <path
          fill-rule="evenodd"
          d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"
        />
        <path
          d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"
        />
      </svg>
    </button>
    <script>
      // crie uma função reiniciar que manda uma mensagem para o servidor para reiniciar o jogo
      function reiniciar() {
        socket.emit("reiniciar");
        // remover o vencedor
        document.getElementById("vencedor").innerHTML = "";
      }
      // Cria o objeto Socket.io
      // pegue da url atual e salve na var url
      var url = window.location.href;
      // remova o http:// e o / do final da url
      url = url.replace("https://", "");
      url = url.replace("http://", "");
      url = url.replace("/brancas", "");
      url = url.replace("/pretas", "");
      // crie uma variavel socket e conecte ao servidor
      const socket = io(url);
      console.log(socket);
      // recebe a vez do servidor
      socket.on("vez", function (vezRecebida) {
        vez = vezRecebida;
        console.log("vez recebida do servidor");
      });
      // crie uma var para indicar quais peças o jogador pode mover com base no url
      var player = 2;

      // variavel com as posições iniciais do tabuleiro
      var board = [
        [0, 1, 0, 1, 0, 1, 0, 1],
        [1, 0, 1, 0, 1, 0, 1, 0],
        [0, 1, 0, 1, 0, 1, 0, 1],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [0, 0, 0, 0, 0, 0, 0, 0],
        [2, 0, 2, 0, 2, 0, 2, 0],
        [0, 2, 0, 2, 0, 2, 0, 2],
        [2, 0, 2, 0, 2, 0, 2, 0],
      ];

      function gerarTabuleiro(matriz) {
        var table = document.getElementById("board");
        // limpa o tabuleiro
        table.innerHTML = "";
        // se a matriz for passada como parâmetro, substitua a matriz do tabuleiro
        board = matriz;
        console.log("matriz substituida");
        // gera o tabuleiro
        for (var i = 0; i < 8; i++) {
          var row = table.insertRow();
          for (var j = 0; j < 8; j++) {
            var cell = row.insertCell();
            if ((i + j) % 2 == 0) {
              cell.className = "light";
            } else {
              cell.className = "dark";
            }
            // adiciona um atributo com a posição da casa
            cell.setAttribute("data-position", i + "," + j);
            if (board[i][j] != 0) {
              var piece = document.createElement("div");
              piece.className = "piece";
              if (board[i][j] == 1) {
                piece.classList.add("black");
              } else if (board[i][j] == 2) {
                piece.classList.add("white");
              } else {
                // se a peça for uma dama preta adicione a classe black e a king e remova a classe white
                if (board[i][j] == 3) {
                  piece.classList.add("white");
                  piece.classList.add("king");
                }
                // se a peça for uma dama branca adicione a classe white e a king e remova a classe black
                if (board[i][j] == 4) {
                  piece.classList.add("black");
                  piece.classList.add("king");
                }
              }

              cell.appendChild(piece);
            }
          }
        }
        // se afor o player 2 gire o tabuleiro
        if (player == 1) {
          table.style.transform = "rotate(180deg)";
        }
        // conta as peças de cada jogador
        var cont1 = 0;
        var cont2 = 0;
        for (var i = 0; i < 8; i++) {
          for (var j = 0; j < 8; j++) {
            if (board[i][j] == 1) {
              cont1++;
            }
            if (board[i][j] == 2) {
              cont2++;
            }
          }
        }
        // se o player 1 ganhar mostre uma mensagem no h2 com o id vencedor
        if (cont1 == 0) {
          document.getElementById("vencedor").innerHTML =
            "A vitória é das brancas";
        }
        // se o player 2 ganhar mostre uma mensagem no h2 com o id vencedor
        if (cont2 == 0) {
          document.getElementById("vencedor").innerHTML =
            "A vitória é das brancas";
        }
      }
      socket.on("board", function (boardRecebida) {
        console.log("matriz recebida do servidor");
        gerarTabuleiro(boardRecebida);
        // clie um evento onclick para as casas do tabuleiro
        var cells = document.querySelectorAll("#board td");
        for (var i = 0; i < cells.length; i++) {
          cells[i].onclick = function () {
            // chame uma função chamada movimentarPeca e paçe como parâmetro a posição da casa e a classe da peça
            // apenas chame a função se a casa tiver uma peça dentro e n tiver a classe selected
            if (
              this.children.length > 0 &&
              !this.classList.contains("selected")
            ) {
              casasLivres(
                this.getAttribute("data-position"),
                this.children[0].className
              );
            }

            // se a casa tiver a classe selected e tiver o atributo data-move
            if (
              this.classList.contains("selected") &&
              this.getAttribute("data-move")
            ) {
              // chame a função movePiece e passe como parâmetro a posição da casa e a posição da casa que será movimentada e a posição da casa que será capturada
              movePiece(
                this.getAttribute("data-position"),
                this.getAttribute("data-move"),
                this.getAttribute("data-capture")
              );
            }
          };
        }
      });
      // crie a função casas livres e crie um switcase para cada peça
      function casasLivres(position, piece) {
        // se n for a vez do jogador, retorne
        if (vez != player) {
          return;
        }
        // localize todas as casas do tabuleiro
        var cells = document.querySelectorAll("#board td");
        // sempre que a função for chamada remova a classe selected, e todos os atributos adicionados de todas as casas
        for (var i = 0; i < cells.length; i++) {
          cells[i].classList.remove("selected");
          cells[i].removeAttribute("data-move");
          cells[i].removeAttribute("data-capture");
        }
        switch (piece) {
          case "piece black":
            // se for a vez das peças pretas
            if (vez == 1) {
              // localize as casas que podem ser movimentadas
              var casa1 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) + 1) +
                  "," +
                  (parseInt(position[2]) + 1) +
                  "']"
              );
              var casa2 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) + 1) +
                  "," +
                  (parseInt(position[2]) - 1) +
                  "']"
              );
              // se a casa1 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa1 != null && casa1.children.length == 0) {
                casa1.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa1.setAttribute("data-move", position);
              }
              // se a casa2 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa2 != null && casa2.children.length == 0) {
                casa2.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa2.setAttribute("data-move", position);
              }
              // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura1
              if (
                casa1 != null &&
                casa1.children.length > 0 &&
                casa1.children[0].classList.contains("white")
              ) {
                var captura1 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) + 2) +
                    "," +
                    (parseInt(position[2]) + 2) +
                    "']"
                );
                if (captura1 != null && captura1.children.length == 0) {
                  captura1.classList.add("selected");
                  captura1.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura1.setAttribute(
                    "data-capture",
                    casa1.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura2
              if (
                casa2 != null &&
                casa2.children.length > 0 &&
                casa2.children[0].classList.contains("white")
              ) {
                var captura2 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) + 2) +
                    "," +
                    (parseInt(position[2]) - 2) +
                    "']"
                );
                if (captura2 != null && captura2.children.length == 0) {
                  captura2.classList.add("selected");
                  captura2.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura2.setAttribute(
                    "data-capture",
                    casa2.getAttribute("data-position")
                  );
                }
              }
            }
            console.log("peça preta");
            break;
          case "piece white":
            // se for a vez das peças brancas
            if (vez == 2) {
              // localize as casas que podem ser movimentadas
              var casa1 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 1) +
                  "," +
                  (parseInt(position[2]) + 1) +
                  "']"
              );
              var casa2 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 1) +
                  "," +
                  (parseInt(position[2]) - 1) +
                  "']"
              );
              // se a casa1 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa1 != null && casa1.children.length == 0) {
                casa1.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa1.setAttribute("data-move", position);
              }
              // se a casa2 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa2 != null && casa2.children.length == 0) {
                casa2.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa2.setAttribute("data-move", position);
              }
              // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura1
              if (
                casa1 != null &&
                casa1.children.length > 0 &&
                casa1.children[0].classList.contains("black")
              ) {
                var captura1 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) - 2) +
                    "," +
                    (parseInt(position[2]) + 2) +
                    "']"
                );
                if (captura1 != null && captura1.children.length == 0) {
                  captura1.classList.add("selected");
                  captura1.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura1.setAttribute(
                    "data-capture",
                    casa1.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura2
              if (
                casa2 != null &&
                casa2.children.length > 0 &&
                casa2.children[0].classList.contains("black")
              ) {
                var captura2 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) - 2) +
                    "," +
                    (parseInt(position[2]) - 2) +
                    "']"
                );
                if (captura2 != null && captura2.children.length == 0) {
                  captura2.classList.add("selected");
                  captura2.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura2.setAttribute(
                    "data-capture",
                    casa2.getAttribute("data-position")
                  );
                }
              }
            }
            console.log("peça branca");
            break;
          case "piece white king":
            // se for a vez das peças brancas e a peça for uma rainha permita o movimento em todas as direções
            if (vez == 2) {
              // localize as casas que podem ser movimentadas
              var casa1 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 1) +
                  "," +
                  (parseInt(position[2]) + 1) +
                  "']"
              );
              var casa2 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 1) +
                  "," +
                  (parseInt(position[2]) - 1) +
                  "']"
              );
              var casa3 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) + 1) +
                  "," +
                  (parseInt(position[2]) + 1) +
                  "']"
              );
              var casa4 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) + 1) +
                  "," +
                  (parseInt(position[2]) - 1) +
                  "']"
              );
              // se a casa1 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa1 != null && casa1.children.length == 0) {
                casa1.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa1.setAttribute("data-move", position);
              }
              // se a casa2 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa2 != null && casa2.children.length == 0) {
                casa2.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa2.setAttribute("data-move", position);
              }
              // se a casa3 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa3 != null && casa3.children.length == 0) {
                casa3.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa3.setAttribute("data-move", position);
              }
              // se a casa4 estiver vazia e for diferente de null adicione a classe selected na casa
              if (casa4 != null && casa4.children.length == 0) {
                casa4.classList.add("selected");
                // adicione o atributo data-move com a posição da peça que será movimentada
                casa4.setAttribute("data-move", position);
              }
              // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura1
              if (
                casa1 != null &&
                casa1.children.length > 0 &&
                casa1.children[0].classList.contains("black")
              ) {
                var captura1 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) - 2) +
                    "," +
                    (parseInt(position[2]) + 2) +
                    "']"
                );
                if (captura1 != null && captura1.children.length == 0) {
                  captura1.classList.add("selected");
                  captura1.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura1.setAttribute(
                    "data-capture",
                    casa1.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura2
              if (
                casa2 != null &&
                casa2.children.length > 0 &&
                casa2.children[0].classList.contains("black")
              ) {
                var captura2 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) - 2) +
                    "," +
                    (parseInt(position[2]) - 2) +
                    "']"
                );
                if (captura2 != null && captura2.children.length == 0) {
                  captura2.classList.add("selected");
                  captura2.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura2.setAttribute(
                    "data-capture",
                    casa2.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 3, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura3
              if (
                casa3 != null &&
                casa3.children.length > 0 &&
                casa3.children[0].classList.contains("black")
              ) {
                var captura3 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) + 2) +
                    "," +
                    (parseInt(position[2]) + 2) +
                    "']"
                );
                if (captura3 != null && captura3.children.length == 0) {
                  captura3.classList.add("selected");
                  captura3.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura3.setAttribute(
                    "data-capture",
                    casa3.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 4, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura4
              if (
                casa4 != null &&
                casa4.children.length > 0 &&
                casa4.children[0].classList.contains("black")
              ) {
                var captura4 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) + 2) +
                    "," +
                    (parseInt(position[2]) - 2) +
                    "']"
                );
                if (captura4 != null && captura4.children.length == 0) {
                  captura4.classList.add("selected");
                  captura4.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura4.setAttribute(
                    "data-capture",
                    casa4.getAttribute("data-position")
                  );
                }
              }
            }
            break;
          case "piece black king":
            // use o mesmo processo do case "piece white king" para calcular as casas que o rei pode se movimentar
            if (vez == 1) {
              // localize as casas que podem ser movimentadas
              var casa1 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 1) +
                  "," +
                  (parseInt(position[2]) + 1) +
                  "']"
              );
              var casa2 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 1) +
                  "," +
                  (parseInt(position[2]) - 1) +
                  "']"
              );
              var casa3 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) + 1) +
                  "," +
                  (parseInt(position[2]) + 1) +
                  "']"
              );
              var casa4 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) + 1) +
                  "," +
                  (parseInt(position[2]) - 1) +
                  "']"
              );
              // se a casa existir e estiver vazia, adicione a classe selected
              if (casa1 != null && casa1.children.length == 0) {
                casa1.classList.add("selected");
                casa1.setAttribute("data-move", position);
              }
              if (casa2 != null && casa2.children.length == 0) {
                casa2.classList.add("selected");
                casa2.setAttribute("data-move", position);
              }
              if (casa3 != null && casa3.children.length == 0) {
                casa3.classList.add("selected");
                casa3.setAttribute("data-move", position);
              }
              if (casa4 != null && casa4.children.length == 0) {
                casa4.classList.add("selected");
                casa4.setAttribute("data-move", position);
              }
              // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura1
              if (
                casa1 != null &&
                casa1.children.length > 0 &&
                casa1.children[0].classList.contains("white")
              ) {
                var captura1 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) - 2) +
                    "," +
                    (parseInt(position[2]) + 2) +
                    "']"
                );
                if (captura1 != null && captura1.children.length == 0) {
                  captura1.classList.add("selected");
                  captura1.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura1.setAttribute(
                    "data-capture",
                    casa1.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura2
              if (
                casa2 != null &&
                casa2.children.length > 0 &&
                casa2.children[0].classList.contains("white")
              ) {
                var captura2 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) - 2) +
                    "," +
                    (parseInt(position[2]) - 2) +
                    "']"
                );
                if (captura2 != null && captura2.children.length == 0) {
                  captura2.classList.add("selected");
                  captura2.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura2.setAttribute(
                    "data-capture",
                    casa2.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 3, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura3
              if (
                casa3 != null &&
                casa3.children.length > 0 &&
                casa3.children[0].classList.contains("white")
              ) {
                var captura3 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) + 2) +
                    "," +
                    (parseInt(position[2]) + 2) +
                    "']"
                );
                if (captura3 != null && captura3.children.length == 0) {
                  captura3.classList.add("selected");
                  captura3.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura3.setAttribute(
                    "data-capture",
                    casa3.getAttribute("data-position")
                  );
                }
              }
              // se tiver uma peça adversária na casa 4, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
              // dica: chame a variavel de captura4
              if (
                casa4 != null &&
                casa4.children.length > 0 &&
                casa4.children[0].classList.contains("white")
              ) {
                var captura4 = document.querySelector(
                  "[data-position='" +
                    (parseInt(position[0]) + 2) +
                    "," +
                    (parseInt(position[2]) - 2) +
                    "']"
                );
                if (captura4 != null && captura4.children.length == 0) {
                  captura4.classList.add("selected");
                  captura4.setAttribute("data-move", position);
                  // adicione um atributo indicando a posição da peça que será capturada
                  captura4.setAttribute(
                    "data-capture",
                    casa4.getAttribute("data-position")
                  );
                }
              }
            }
            break;

          default:
            console.log("casa vazia");
        }
      }

      // crie a função movePiece e passe como parâmetro a posição da casa e a posição da casa que será movimentada
      function movePiece(position, move, capture) {
        //se n for a vez do jogador, não faça nada
        if (player != vez) {
          return;
        }
        // localize a casa que será movimentada
        var casa = document.querySelector(
          "[data-position='" + move[0] + "," + move[2] + "']"
        );
        // localize a peça que será movimentada
        var peca = document.querySelector(
          "[data-position='" + position[0] + "," + position[2] + "']"
        );
        // adicione a peça na casa
        peca.appendChild(casa.children[0]);
        // remova a classe selected de todas as casas
        // localize todas as casas do tabuleiro
        var cells = document.querySelectorAll("#board td");
        for (var i = 0; i < cells.length; i++) {
          cells[i].classList.remove("selected");
        }

        // verifica se a pela pode se tornar uma dama
        if (peca.children[0].classList.contains("white")) {
          if (parseInt(position[0]) == 0) {
            peca.children[0].classList.add("king");
          }
        } else {
          if (parseInt(position[0]) == 7) {
            peca.children[0].classList.add("king");
          }
        }
        // se a casa que será movimentada tiver o atributo data-capture
        if (capture) {
          // localize a peça que será capturada
          var pecaCapturada = document.querySelector(
            "[data-position='" + capture[0] + "," + capture[2] + "']"
          );
          // remova a peça capturada do tabuleiro
          pecaCapturada.removeChild(pecaCapturada.children[0]);
          // chama a função que verifica se a peça pode capturar novamente
          // se retornar true, mantem a vez da peça
          // se retornar false, muda a vez da peça
          // se a peça ainda pode capturar, mantem a vez dela
          // crie uma matriz bidimensional com a posição de todas as peças
          // dica: as casas do tabuleiro são td, e as peças são div
          var matriz = [];
          for (var i = 0; i < 8; i++) {
            matriz[i] = [];
            for (var j = 0; j < 8; j++) {
              matriz[i][j] = 0;
            }
          }
          for (var i = 0; i < cells.length; i++) {
            if (cells[i].children.length > 0) {
              var positionMatriz = cells[i]
                .getAttribute("data-position")
                .split(",");
              // se a peça é uma dama
              if (cells[i].children[0].classList.contains("king")) {
                // salve a peça na matriz com 3 ou 4
                matriz[positionMatriz[0]][positionMatriz[1]] = cells[
                  i
                ].children[0].classList.contains("black")
                  ? 4
                  : 3;
              } else {
                // salve a peça na matriz com 1 ou 0
                matriz[positionMatriz[0]][positionMatriz[1]] = cells[
                  i
                ].children[0].classList.contains("black")
                  ? 1
                  : 2;
              }
            }
          }
          if (!checkCapture(position)) {
            // chame a função som
            som(
              "https://st5.depositphotos.com/73923158/a/depositphotos_633221038-track-sound-effect-rolling-single-chess.mp3"
            );
            // mude a vez da peça
            vez = vez == 1 ? 2 : 1;
            // envia a vez para o servidor
            socket.emit("vez", vez);
            console.log(board);
          }
        } else {
          som(
            "https://st2.depositphotos.com/43474674/a/depositphotos_431829068-track-clattering-wooden-plastic-tiles.mp3"
          );
          // mude a vez da peça
          vez = vez == 1 ? 2 : 1;
          // envia a vez para o servidor
          socket.emit("vez", vez);
          var matriz = [];
          for (var i = 0; i < 8; i++) {
            matriz[i] = [];
            for (var j = 0; j < 8; j++) {
              matriz[i][j] = 0;
            }
          }
          for (var i = 0; i < cells.length; i++) {
            if (cells[i].children.length > 0) {
              var positionMatriz = cells[i]
                .getAttribute("data-position")
                .split(",");
              // se a peça é uma dama
              if (cells[i].children[0].classList.contains("king")) {
                // salve a peça na matriz com 3 ou 4
                matriz[positionMatriz[0]][positionMatriz[1]] = cells[
                  i
                ].children[0].classList.contains("black")
                  ? 4
                  : 3;
              } else {
                // salve a peça na matriz com 1 ou 0
                matriz[positionMatriz[0]][positionMatriz[1]] = cells[
                  i
                ].children[0].classList.contains("black")
                  ? 1
                  : 2;
              }
            }
          }
          // chame a função gerarTabuleiro passando a matriz como parâmetro
          gerarTabuleiro(matriz);
          socket.emit("board", board);
        }
        // remova os atributos data-move e data-capture da casa
        casa.removeAttribute("data-move");
        casa.removeAttribute("data-capture");
      }
      // crie a função checkCapture e passe como parâmetro a posição da casa que foi movimentada
      function checkCapture(position) {
        // crie uma matriz bidimensional com a posição de todas as peças
        // dica: as casas do tabuleiro são td, e as peças são div
        var matriz = [];
        for (var i = 0; i < 8; i++) {
          matriz[i] = [];
          for (var j = 0; j < 8; j++) {
            matriz[i][j] = 0;
          }
        }
        // localize todas as casas do tabuleiro
        var cells = document.querySelectorAll("#board td");
        for (var i = 0; i < cells.length; i++) {
          if (cells[i].children.length > 0) {
            var positionMatriz = cells[i]
              .getAttribute("data-position")
              .split(",");
            // se a peça é uma dama
            if (cells[i].children[0].classList.contains("king")) {
              // salve a peça na matriz com 3 ou 4
              matriz[positionMatriz[0]][positionMatriz[1]] = cells[
                i
              ].children[0].classList.contains("black")
                ? 4
                : 3;
            } else {
              // salve a peça na matriz com 1 ou 0
              matriz[positionMatriz[0]][positionMatriz[1]] = cells[
                i
              ].children[0].classList.contains("black")
                ? 1
                : 2;
            }
          }
        }
        // chame a função gerarTabuleiro passando a matriz como parâmetro
        gerarTabuleiro(matriz);
        socket.emit("board", board);
        // localize a peça que foi movimentada
        var peca = document.querySelector(
          "[data-position='" + position[0] + "," + position[2] + "']"
        );
        // se a peça for branca e existir
        if (peca.children.length > 0) {
          if (peca.children[0].classList.contains("white")) {
            // localize a casa que está a frente da peça branca
            var casa1 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) - 1) +
                "," +
                (parseInt(position[2]) - 1) +
                "']"
            );
            // localize a casa que está a frente da peça branca
            var casa2 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) - 1) +
                "," +
                (parseInt(position[2]) + 1) +
                "']"
            );
            // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
            if (
              casa1 != null &&
              casa1.children.length > 0 &&
              casa1.children[0].classList.contains("black")
            ) {
              var captura1 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 2) +
                  "," +
                  (parseInt(position[2]) - 2) +
                  "']"
              );
              if (captura1 != null && captura1.children.length == 0) {
                return true;
              }
            }
            // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
            if (
              casa2 != null &&
              casa2.children.length > 0 &&
              casa2.children[0].classList.contains("black")
            ) {
              var captura2 = document.querySelector(
                "[data-position='" +
                  (parseInt(position[0]) - 2) +
                  "," +
                  (parseInt(position[2]) + 2) +
                  "']"
              );
              if (captura2 != null && captura2.children.length == 0) {
                // chame a função gerarTabuleiro passando a matriz como parâmetro
                gerarTabuleiro(matriz);
                socket.emit("board", board);
                return true;
              }
            }
          }
        }
        // se a peça for preta
        if (peca.children[0].classList.contains("black")) {
          // localize a casa que está a frente da peça preta
          var casa1 = document.querySelector(
            "[data-position='" +
              (parseInt(position[0]) + 1) +
              "," +
              (parseInt(position[2]) + 1) +
              "']"
          );
          // localize a casa que está a frente da peça preta
          var casa2 = document.querySelector(
            "[data-position='" +
              (parseInt(position[0]) + 1) +
              "," +
              (parseInt(position[2]) - 1) +
              "']"
          );
          // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
          if (
            casa1 != null &&
            casa1.children.length > 0 &&
            casa1.children[0].classList.contains("white")
          ) {
            var captura1 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) + 2) +
                "," +
                (parseInt(position[2]) + 2) +
                "']"
            );
            if (captura1 != null && captura1.children.length == 0) {
              // chame a função gerarTabuleiro passando a matriz como parâmetro
              gerarTabuleiro(matriz);
              socket.emit("board", board);
              return true;
            }
          }
          // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
          if (
            casa2 != null &&
            casa2.children.length > 0 &&
            casa2.children[0].classList.contains("white")
          ) {
            var captura2 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) + 2) +
                "," +
                (parseInt(position[2]) - 2) +
                "']"
            );
            if (captura2 != null && captura2.children.length == 0) {
              // chame a função gerarTabuleiro passando a matriz como parâmetro
              gerarTabuleiro(matriz);
              socket.emit("board", board);
              return true;
            }
          }
        }
        // se tiver as classes piece white king
        if (
          peca.children[0].classList.contains("white") &&
          peca.children[0].classList.contains("king")
        ) {
          console.log("dama branca");
          // localize as casas que estão atraz da peça branca
          // dica: chame elas de tras 1 e tras 2
          var tras1 = document.querySelector(
            "[data-position='" +
              (parseInt(position[0]) + 1) +
              "," +
              (parseInt(position[2]) + 1) +
              "']"
          );
          var tras2 = document.querySelector(
            "[data-position='" +
              (parseInt(position[0]) + 1) +
              "," +
              (parseInt(position[2]) - 1) +
              "']"
          );
          // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
          if (
            tras1 != null &&
            tras1.children.length > 0 &&
            tras1.children[0].classList.contains("black")
          ) {
            var captura1 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) + 2) +
                "," +
                (parseInt(position[2]) + 2) +
                "']"
            );
            if (captura1 != null && captura1.children.length == 0) {
              // chame a função gerarTabuleiro passando a matriz como parâmetro
              gerarTabuleiro(matriz);
              socket.emit("board", board);
              return true;
            }
          }
          // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
          if (
            tras2 != null &&
            tras2.children.length > 0 &&
            tras2.children[0].classList.contains("black")
          ) {
            var captura2 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) + 2) +
                "," +
                (parseInt(position[2]) - 2) +
                "']"
            );
            if (captura2 != null && captura2.children.length == 0) {
              // chame a função gerarTabuleiro passando a matriz como parâmetro
              gerarTabuleiro(matriz);
              socket.emit("board", board);
              return true;
            }
          }
        }
        // se tiver as classes piece black king
        if (
          peca.children[0].classList.contains("black") &&
          peca.children[0].classList.contains("king")
        ) {
          console.log("dama preta");
          // localize as casas que estão atraz da peça preta
          // dica: chame elas de tras 1 e tras 2
          var tras1 = document.querySelector(
            "[data-position='" +
              (parseInt(position[0]) - 1) +
              "," +
              (parseInt(position[2]) + 1) +
              "']"
          );
          var tras2 = document.querySelector(
            "[data-position='" +
              (parseInt(position[0]) - 1) +
              "," +
              (parseInt(position[2]) - 1) +
              "']"
          );
          // se tiver uma peça adversária na casa 1, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
          if (
            tras1 != null &&
            tras1.children.length > 0 &&
            tras1.children[0].classList.contains("white")
          ) {
            var captura1 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) - 2) +
                "," +
                (parseInt(position[2]) + 2) +
                "']"
            );
            if (captura1 != null && captura1.children.length == 0) {
              // chame a função gerarTabuleiro passando a matriz como parâmetro
              gerarTabuleiro(matriz);
              socket.emit("board", board);
              return true;
            }
          }
          // se tiver uma peça adversária na casa 2, calcule a posição da casa que está a frente da peça adversária e verifique se a mesma está vazia e existe
          if (
            tras2 != null &&
            tras2.children.length > 0 &&
            tras2.children[0].classList.contains("white")
          ) {
            var captura2 = document.querySelector(
              "[data-position='" +
                (parseInt(position[0]) - 2) +
                "," +
                (parseInt(position[2]) - 2) +
                "']"
            );
            if (captura2 != null && captura2.children.length == 0) {
              // chame a função gerarTabuleiro passando a matriz como parâmetro
              gerarTabuleiro(matriz);
              socket.emit("board", board);
              return true;
            }
          }
        }
        // chame a função gerarTabuleiro passando a matriz como parâmetro
        gerarTabuleiro(matriz);
        socket.emit("board", board);
        // se não tiver nenhuma peça adversária na frente da peça, retorne false
        return false;
      }

      // crie a função som
      function som(som) {
        console.log("som");
        // crie uma variável chamada audio e atribua a ela um novo elemento audio
        var audio = new Audio();
        // atribua a variável audio o caminho do arquivo de audio
        audio.src = som;
        // chame o método play do elemento audio
        audio.play();
      }
    </script>
  </body>
</html>
